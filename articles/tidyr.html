<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Compare with Tidyr's Rectangling • unnest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compare with Tidyr's Rectangling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">unnest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tidyr.html">Compare with Tidyr's Rectangling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vspinu/unnest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compare with Tidyr's Rectangling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vspinu/unnest/blob/master/vignettes/tidyr.Rmd" class="external-link"><code>vignettes/tidyr.Rmd</code></a></small>
      <div class="d-none name"><code>tidyr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>As per <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a>
definition unnesting (or rectangling):</p>
<pre><code> ... is the art and craft of taking a deeply nested list (often sourced
 from wild caught JSON or XML) and taming it into a tidy data set of rows and
 columns. There are three functions from tidyr that are particularly useful for
 rectangling:</code></pre>
<p><a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a>
core functions for unnesting are <code><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer()</a></code>,
<code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist()</a></code>. This guide follows
the steps from <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a>
vignette and translates them into <code>unnest</code>’s language.</p>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a> you
have to unnest lists in several steps by using one of the three core
functions. With <code>unnest</code> you do all at once in one step.
<code>unnest</code> doesn’t produce intermediate list columns.</p>
<p>We’ll use the <code>repurrrsive</code> package as the source of our
nested lists:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jennybc.github.io/repurrrsive/" class="external-link">repurrrsive</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vspinu/unnest" class="external-link">unnest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>unnest.return.type <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="github-repos">GitHub repos<a class="anchor" aria-label="anchor" href="#github-repos"></a>
</h2>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a> you
start by putting a list into a data.frame column. With <a href="https://vspinu.github.io/unnest/">unnest</a> this is not
necessary.</p>
<p><code>gh_repos</code> is a nested list with maximal depth of 4
“user”&gt;“repo”&gt;“owner”&gt;“[xyz]”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">gh_repos</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"owner"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Let’s say that we want a <code>data.frame</code> with 3 columns,
“name”, “homepage” and “watchers_count”, from level 3 of repo
characteristics and one,“login”, from level 4 of owner characteristics.
This is how it’s done with <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>repo <span class="op">=</span> <span class="va">gh_repos</span><span class="op">)</span></span>
<span><span class="va">repos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">repos</span>, <span class="va">repo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">repos</span>, <span class="va">repo</span>,</span>
<span>      login <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"owner"</span>, <span class="st">"login"</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>      homepage <span class="op">=</span> <span class="st">"homepage"</span>,</span>
<span>      watchers <span class="op">=</span> <span class="st">"watchers_count"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">repo</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 176 × 4</span></span></span>
<span><span class="co">#&gt;    login       name        homepage watchers</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> gaborcsardi after       <span style="color: #BB0000;">NA</span>              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> gaborcsardi argufy      <span style="color: #BB0000;">NA</span>             19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> gaborcsardi ask         <span style="color: #BB0000;">NA</span>              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gaborcsardi baseimports <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> gaborcsardi citest      <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> gaborcsardi clisymbols  <span style="color: #949494;">""</span>             18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> gaborcsardi cmaker      <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> gaborcsardi cmark       <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> gaborcsardi conditions  <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> gaborcsardi crayon      <span style="color: #BB0000;">NA</span>             52</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 166 more rows</span></span></span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"homepage"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"watchers_count"</span>, as <span class="op">=</span> <span class="st">"watchers"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"owner"</span>,</span>
<span>              <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"login"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">gh_repos</span>, <span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 176 × 4</span></span></span>
<span><span class="co">#&gt;    homepage name        owner.login watchers</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>       after       gaborcsardi        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #BB0000;">NA</span>       argufy      gaborcsardi       19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>       ask         gaborcsardi        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>       baseimports gaborcsardi        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>       citest      gaborcsardi        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">""</span>       clisymbols  gaborcsardi       18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>       cmaker      gaborcsardi        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>       cmark       gaborcsardi        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>       conditions  gaborcsardi        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>       crayon      gaborcsardi       52</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 166 more rows</span></span></span></code></pre></div>
<p><a href="https://vspinu.github.io/unnest/">unnest</a> selectors
(<code><a href="../reference/spec.html">s()</a></code>) apply to corresponding levels of the hierarchy and
describe which elements should be selected and how. The
<code>stack = TRUE</code> says that the result of the extraction should
be stacked row-wise (aka <code>rbind</code>ed).
<code>stack = FALSE</code>, means spread it across multiple columns (aka
<code>cbind</code>ed). The <code>as</code> argument provides the name of
the output. By default it’s the entire path name to the selected
leaf.</p>
<p>Now assume that you want the 3 components of “repos” and all
components of the owner at once:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>repo <span class="op">=</span> <span class="va">gh_repos</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">repo</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">repo</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>        homepage <span class="op">=</span> <span class="st">"homepage"</span>,</span>
<span>        watchers <span class="op">=</span> <span class="st">"watchers_count"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">repo</span>, owner <span class="op">=</span> <span class="st">"owner"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">owner</span><span class="op">)</span></span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"homepage"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"watchers_count"</span>, as <span class="op">=</span> <span class="st">"watchers"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"owner"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">gh_repos</span>, <span class="va">spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 176 × 20</span></span></span>
<span><span class="co">#&gt;    homepage name        owner.avatar_url    owner.events_url owner.followers_url</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>       after       https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #BB0000;">NA</span>       argufy      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>       ask         https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>       baseimports https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>       citest      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">""</span>       clisymbols  https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>       cmaker      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>       cmark       https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>       conditions  https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>       crayon      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 166 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more variables: owner.following_url &lt;chr&gt;, owner.gists_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.gravatar_id &lt;chr&gt;, owner.html_url &lt;chr&gt;, owner.id &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.login &lt;chr&gt;, owner.organizations_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.received_events_url &lt;chr&gt;, owner.repos_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.site_admin &lt;lgl&gt;, owner.starred_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.subscriptions_url &lt;chr&gt;, owner.type &lt;chr&gt;, owner.url &lt;chr&gt;, …</span></span></span></code></pre></div>
<p>Note that <a href="https://vspinu.github.io/unnest/">unnest</a>
produces namespaced column names, while [tidyr’[s is not. This is a good
thing as you don’t have to worry about conflicting names. <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link">tidyr</a>
provides a “fix” for duplicated names in the form of
<code>names_repair</code> argument to its functions.</p>
</div>
<div class="section level2">
<h2 id="game-of-thrones-characters">Game of Thrones characters<a class="anchor" aria-label="anchor" href="#game-of-thrones-characters"></a>
</h2>
<p>What do you do with non-singleton leafs? Those are normally stacked,
spread or melted depending on the analysis. For example the Game of
Thrones dataset contains non-singleton leafs “titles”, “aliases”,
“books” etc.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">got_chars</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at some common scenarios.</p>
<div class="section level3">
<h3 id="stacking">Stacking<a class="anchor" aria-label="anchor" href="#stacking"></a>
</h3>
<p>Assume that we want a row for every book and TV series that the
character appears in. That is, we want a long table with all
combinations (aka cross product) of books and TV series.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>char <span class="op">=</span> <span class="va">got_chars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">char</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">books</span>, <span class="va">tvSeries</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">books</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">tvSeries</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 230 × 3</span></span></span>
<span><span class="co">#&gt;    name          books             tvSeries</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Theon Greyjoy A Game of Thrones Season 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Theon Greyjoy A Game of Thrones Season 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Theon Greyjoy A Game of Thrones Season 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Theon Greyjoy A Game of Thrones Season 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Theon Greyjoy A Game of Thrones Season 5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Theon Greyjoy A Game of Thrones Season 6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Theon Greyjoy A Storm of Swords Season 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Theon Greyjoy A Storm of Swords Season 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Theon Greyjoy A Storm of Swords Season 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Theon Greyjoy A Storm of Swords Season 4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 220 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">got_chars</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"books,tvSeries/"</span>, stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 236 × 3</span></span></span>
<span><span class="co">#&gt;    books             name          tvSeries</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> A Game of Thrones Theon Greyjoy Season 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> A Storm of Swords Theon Greyjoy Season 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> A Feast for Crows Theon Greyjoy Season 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> A Game of Thrones Theon Greyjoy Season 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> A Storm of Swords Theon Greyjoy Season 5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> A Feast for Crows Theon Greyjoy Season 6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> A Game of Thrones Theon Greyjoy Season 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> A Storm of Swords Theon Greyjoy Season 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> A Feast for Crows Theon Greyjoy Season 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> A Game of Thrones Theon Greyjoy Season 4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 226 more rows</span></span></span></code></pre></div>
<p>Implementation aside, [tidyr’[s intermediary steps are generally
costly for two reasons. First, because intermediary data.frames are
created during the processing. Second, because intermediary objects
might contain columns that are not needed in the subsequent processing.
In the above examples <code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code> produced man more
columns than we need. A better approach would be to replace it with a
bit more verbose <code>hoist</code> call.</p>
<p>In contrast <a href="https://vspinu.github.io/unnest/">unnest</a>
doesn’t produce intermediary data structures. In fact, <a href="https://vspinu.github.io/unnest/">unnest</a> follows a
0-intermediary-copy semantics. The input vectors are directly copied
into the output, no matter how complex the nesting is.</p>
<p>Cross-product is commonly useful when only one non-singleton variable
is extracted. For example, let’s match title to name:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>char <span class="op">=</span> <span class="va">got_chars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">char</span>, name <span class="op">=</span> <span class="st">"name"</span>, title <span class="op">=</span> <span class="st">"titles"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">char</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 59 × 2</span></span></span>
<span><span class="co">#&gt;    name              title                                                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Theon Greyjoy     <span style="color: #949494;">"</span>Prince of Winterfell<span style="color: #949494;">"</span>                                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Theon Greyjoy     <span style="color: #949494;">"</span>Lord of the Iron Islands (by law of the green lands)<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Tyrion Lannister  <span style="color: #949494;">"</span>Acting Hand of the King (former)<span style="color: #949494;">"</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Tyrion Lannister  <span style="color: #949494;">"</span>Master of Coin (former)<span style="color: #949494;">"</span>                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Victarion Greyjoy <span style="color: #949494;">"</span>Lord Captain of the Iron Fleet<span style="color: #949494;">"</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Victarion Greyjoy <span style="color: #949494;">"</span>Master of the Iron Victory<span style="color: #949494;">"</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Will              <span style="color: #949494;">""</span>                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Areo Hotah        <span style="color: #949494;">"</span>Captain of the Guard at Sunspear<span style="color: #949494;">"</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Chett             <span style="color: #949494;">""</span>                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Cressen           <span style="color: #949494;">"</span>Maester<span style="color: #949494;">"</span>                                             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 49 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">got_chars</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"titles/"</span>, stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 59 × 2</span></span></span>
<span><span class="co">#&gt;    name              titles                                                </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Theon Greyjoy     <span style="color: #949494;">"</span>Prince of Winterfell<span style="color: #949494;">"</span>                                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Theon Greyjoy     <span style="color: #949494;">"</span>Lord of the Iron Islands (by law of the green lands)<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Tyrion Lannister  <span style="color: #949494;">"</span>Acting Hand of the King (former)<span style="color: #949494;">"</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Tyrion Lannister  <span style="color: #949494;">"</span>Master of Coin (former)<span style="color: #949494;">"</span>                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Victarion Greyjoy <span style="color: #949494;">"</span>Lord Captain of the Iron Fleet<span style="color: #949494;">"</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Victarion Greyjoy <span style="color: #949494;">"</span>Master of the Iron Victory<span style="color: #949494;">"</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Will              <span style="color: #949494;">""</span>                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Areo Hotah        <span style="color: #949494;">"</span>Captain of the Guard at Sunspear<span style="color: #949494;">"</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Chett             <span style="color: #949494;">""</span>                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Cressen           <span style="color: #949494;">"</span>Maester<span style="color: #949494;">"</span>                                             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 49 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id-value-long-tables-aka-long-pivoting-or-melting">Id-value long tables (aka long pivoting, or melting)<a class="anchor" aria-label="anchor" href="#id-value-long-tables-aka-long-pivoting-or-melting"></a>
</h3>
<p>A common scenario is to stack the non-scalar leafs and replicate id
labels in a separate “key” column. This is called “melting”
(<code>reshape2</code>) or “long pivoting” (<code>tidyr</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>char <span class="op">=</span> <span class="va">got_chars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">char</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">books</span>, <span class="va">tvSeries</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">books</span>, <span class="va">tvSeries</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"media"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">got_chars</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"books,tvSeries"</span>, stack <span class="op">=</span> <span class="st">"media"</span>, as <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>           <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id-value-wide-tables">Id-value wide tables<a class="anchor" aria-label="anchor" href="#id-value-wide-tables"></a>
</h3>
<p>One might want to stack id vars (media) but spread the measures
(books, tvSeries) horizontally such that each row would contain all
measurement for each media.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># There seem not to be an easy way to achieve this with tidyr</span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">got_chars</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"books,tvSeries"</span>, stack <span class="op">=</span> <span class="st">"media"</span>, as <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wide-tables-aka-spreading">Wide Tables (aka spreading)<a class="anchor" aria-label="anchor" href="#wide-tables-aka-spreading"></a>
</h3>
<p>This strategy is commonly used in machine learning scenarios when
large sparse tables are plugged into black-box ML algorithms. This is
the default behavior in <a href="https://vspinu.github.io/unnest/">unnest</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Currently tidyr errors on double widening due to name conflicts.</span></span>
<span><span class="co"># tibble(char = got_chars) %&gt;%</span></span>
<span><span class="co">#   unnest_wider(char) %&gt;%</span></span>
<span><span class="co">#   select(name, books, tvSeries) %&gt;%</span></span>
<span><span class="co">#   unnest_wider(books) %&gt;%</span></span>
<span><span class="co">#   unnest_wider(tvSeries)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">got_chars</span>, <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>, <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"name, books, tvSeries"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sharla-gelfands-discography">Sharla Gelfand’s discography<a class="anchor" aria-label="anchor" href="#sharla-gelfands-discography"></a>
</h2>
<p>Finally, the most complex transformation from [tidyr’[s vignette can
be achieved with unnest in a single step.</p>
<p>Typical entry of <code>disog</code> collection looks like this</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">discog</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ instance_id      : int 354091476</span></span>
<span><span class="co">#&gt;  $ date_added       : chr "2019-02-13T14:07:23-08:00"</span></span>
<span><span class="co">#&gt;  $ basic_information:List of 11</span></span>
<span><span class="co">#&gt;   ..$ labels      :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 6</span></span>
<span><span class="co">#&gt;   .. .. ..$ name            : chr "La Vida Es Un Mus"</span></span>
<span><span class="co">#&gt;   .. .. ..$ entity_type     : chr "1"</span></span>
<span><span class="co">#&gt;   .. .. ..$ catno           : chr "MUS118"</span></span>
<span><span class="co">#&gt;   .. .. ..$ resource_url    : chr "https://api.discogs.com/labels/38322"</span></span>
<span><span class="co">#&gt;   .. .. ..$ id              : int 38322</span></span>
<span><span class="co">#&gt;   .. .. ..$ entity_type_name: chr "Label"</span></span>
<span><span class="co">#&gt;   ..$ year        : int 2017</span></span>
<span><span class="co">#&gt;   ..$ master_url  : chr "https://api.discogs.com/masters/1109943"</span></span>
<span><span class="co">#&gt;   ..$ artists     :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 7</span></span>
<span><span class="co">#&gt;   .. .. ..$ join        : chr ""</span></span>
<span><span class="co">#&gt;   .. .. ..$ name        : chr "S.H.I.T. (3)"</span></span>
<span><span class="co">#&gt;   .. .. ..$ anv         : chr ""</span></span>
<span><span class="co">#&gt;   .. .. ..$ tracks      : chr ""</span></span>
<span><span class="co">#&gt;   .. .. ..$ role        : chr ""</span></span>
<span><span class="co">#&gt;   .. .. ..$ resource_url: chr "https://api.discogs.com/artists/2769828"</span></span>
<span><span class="co">#&gt;   .. .. ..$ id          : int 2769828</span></span>
<span><span class="co">#&gt;   ..$ id          : int 9827276</span></span>
<span><span class="co">#&gt;   ..$ thumb       : chr "https://img.discogs.com/x6GUri3hXAcfzF2wz5jQloomOoY=/fit-in/150x150/filters:strip_icc():format(jpeg):mode_rgb()"| __truncated__</span></span>
<span><span class="co">#&gt;   ..$ title       : chr "I"</span></span>
<span><span class="co">#&gt;   ..$ formats     :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ descriptions:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ : chr "7\""</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ : chr "45 RPM"</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ : chr "EP"</span></span>
<span><span class="co">#&gt;   .. .. ..$ name        : chr "Vinyl"</span></span>
<span><span class="co">#&gt;   .. .. ..$ qty         : chr "1"</span></span>
<span><span class="co">#&gt;   ..$ cover_image : chr "https://img.discogs.com/7aJPlo2phtFL-T2Kt6MTBc0uftY=/fit-in/600x600/filters:strip_icc():format(jpeg):mode_rgb()"| __truncated__</span></span>
<span><span class="co">#&gt;   ..$ resource_url: chr "https://api.discogs.com/releases/9827276"</span></span>
<span><span class="co">#&gt;   ..$ master_id   : int 1109943</span></span>
<span><span class="co">#&gt;  $ id               : int 9827276</span></span>
<span><span class="co">#&gt;  $ rating           : int 0</span></span></code></pre></div>
<p>We want to extract <code>artists</code> metadata and
<code>formats</code> into separate tables.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>disc <span class="op">=</span> <span class="va">discog</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">disc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">basic_information</span>, artist <span class="op">=</span> <span class="st">"artists"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>disc_id <span class="op">=</span> <span class="va">id</span>, <span class="va">artist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">artist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">artist</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 167 × 8</span></span></span>
<span><span class="co">#&gt;     disc_id join  name                    anv   tracks role  resource_url     id</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  7<span style="text-decoration: underline;">496</span>378 <span style="color: #949494;">""</span>    Mollot                  <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 4.62<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  4<span style="text-decoration: underline;">490</span>852 <span style="color: #949494;">""</span>    Una Bèstia Incontrolab… <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 3.19<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  9<span style="text-decoration: underline;">827</span>276 <span style="color: #949494;">""</span>    S.H.I.T. (3)            <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 2.77<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  9<span style="text-decoration: underline;">769</span>203 <span style="color: #949494;">""</span>    Rata Negra              <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 4.28<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  7<span style="text-decoration: underline;">237</span>138 <span style="color: #949494;">""</span>    Ivy (18)                <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 3.60<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 13<span style="text-decoration: underline;">117</span>042 <span style="color: #949494;">""</span>    Tashme                  <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 5.21<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  7<span style="text-decoration: underline;">113</span>575 <span style="color: #949494;">""</span>    Desgraciados            <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 4.45<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10<span style="text-decoration: underline;">540</span>713 <span style="color: #949494;">""</span>    Phantom Head            <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 4.27<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 11<span style="text-decoration: underline;">260</span>950 <span style="color: #949494;">""</span>    Sub Space (2)           <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 5.69<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 11<span style="text-decoration: underline;">726</span>853 <span style="color: #949494;">""</span>    Small Man (2)           <span style="color: #949494;">""</span>    <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>    https://api… 6.37<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 157 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>disc <span class="op">=</span> <span class="va">discog</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">disc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">basic_information</span>, format <span class="op">=</span> <span class="st">"formats"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>disc_id <span class="op">=</span> <span class="va">id</span>, <span class="va">format</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">format</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">format</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">descriptions</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 258 × 5</span></span></span>
<span><span class="co">#&gt;     disc_id descriptions text  name     qty  </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  7<span style="text-decoration: underline;">496</span>378 <span style="color: #949494;">"</span>Numbered<span style="color: #949494;">"</span>   Black Cassette 1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  4<span style="text-decoration: underline;">490</span>852 <span style="color: #949494;">"</span>LP<span style="color: #949494;">"</span>         <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  9<span style="text-decoration: underline;">827</span>276 <span style="color: #949494;">"</span>7\"<span style="color: #949494;">"</span>        <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  9<span style="text-decoration: underline;">827</span>276 <span style="color: #949494;">"</span>45 RPM<span style="color: #949494;">"</span>     <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  9<span style="text-decoration: underline;">827</span>276 <span style="color: #949494;">"</span>EP<span style="color: #949494;">"</span>         <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  9<span style="text-decoration: underline;">769</span>203 <span style="color: #949494;">"</span>LP<span style="color: #949494;">"</span>         <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  9<span style="text-decoration: underline;">769</span>203 <span style="color: #949494;">"</span>Album<span style="color: #949494;">"</span>      <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  7<span style="text-decoration: underline;">237</span>138 <span style="color: #949494;">"</span>7\"<span style="color: #949494;">"</span>        <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  7<span style="text-decoration: underline;">237</span>138 <span style="color: #949494;">"</span>45 RPM<span style="color: #949494;">"</span>     <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 13<span style="text-decoration: underline;">117</span>042 <span style="color: #949494;">"</span>7\"<span style="color: #949494;">"</span>        <span style="color: #BB0000;">NA</span>    Vinyl    1    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 248 more rows</span></span></span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a> you can
achieve this in two separate passes through the list, or in a single
pass with a grouped children specification. The single pass extraction
returns a list of data.frames, but scans the data only once.</p>
<p>Separate unnest calls:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">discog</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"id"</span>, as <span class="op">=</span> <span class="st">"disc_id"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"basic_information/artists"</span>, as <span class="op">=</span> <span class="st">"artist"</span>,</span>
<span>           <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">discog</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"id"</span>, as <span class="op">=</span> <span class="st">"disc_id"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"basic_information/formats"</span>, as <span class="op">=</span> <span class="st">"format"</span>,</span>
<span>           <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>             <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>exclude <span class="op">=</span> <span class="st">"descriptions"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"descriptions/"</span>, stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Single unnest pass:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">discog</span>,</span>
<span>       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         groups <span class="op">=</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>artists <span class="op">=</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"id"</span>, as <span class="op">=</span> <span class="st">"disc_id"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"basic_information/artists"</span>, as <span class="op">=</span> <span class="st">"artist"</span>,</span>
<span>                         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                formats <span class="op">=</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"id"</span>, as <span class="op">=</span> <span class="st">"disc_id"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"basic_information/formats"</span>, as <span class="op">=</span> <span class="st">"format"</span>,</span>
<span>                         <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>stack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                           <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span>exclude <span class="op">=</span> <span class="st">"descriptions"</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="../reference/spec.html">s</a></span><span class="op">(</span><span class="st">"descriptions/"</span>, stack <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The unnest specs inside <code>groups</code> is the same as in the
separate-calls case. The <code>groups</code> argument is just like
<code>children</code> argument with the difference that the output of
the extraction is not cross-joined, but simply returned as list.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Currently &lt;code&gt;groups&lt;/code&gt; argument works only with
the top level of the unnest specification.&lt;/p&gt;"><sup>1</sup></a></p>
<p>The benefit is grouped extraction is twofold. First, it’s faster
because the list is traversed only once. Second, the de-duplication
works across groups. That is, when <code>dedupe = TRUE</code> (not shown
in the above examples), the fields extracted by the preceding specs are
not extracted by the specs that follow.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/vspinu" class="external-link">Vitalie Spinu</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
